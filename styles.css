// Aquí están los productos reales de diademas gamer

const productos = [
  {
    id: 1,
    nombre: "Diadema Gamer RGB Logitech G Pro X",
    precio: 120.0,
    categoria: "gaming",
    img: "https://m.media-amazon.com/images/I/91m2i6c9v1L._AC_SL1500_.jpg"
  },
  {
    id: 2,
    nombre: "Diadema Gamer Corsair HS50 Pro",
    precio: 60.0,
    categoria: "gaming",
    img: "https://m.media-amazon.com/images/I/91HYkxBOJ4L._AC_SL1500_.jpg"
  },
  {
    id: 3,
    nombre: "Diadema Gaming Razer Kraken V3",
    precio: 140.0,
    categoria: "gaming",
    img: "https://m.media-amazon.com/images/I/61WjFNsH4jL._AC_SL1500_.jpg"
  },
  {
    id: 4,
    nombre: "Diadema Normal Sony MDR-ZX110",
    precio: 30.0,
    categoria: "normal",
    img: "https://m.media-amazon.com/images/I/71yD6l6y1hL._AC_SL1500_.jpg"
  },
  {
    id: 5,
    nombre: "Diadema Gaming SteelSeries Arctis 7",
    precio: 180.0,
    categoria: "gaming",
    img: "https://m.media-amazon.com/images/I/61tRPV6J5-L._AC_SL1500_.jpg"
  },
  {
    id: 6,
    nombre: "Diadema Normal Sennheiser HD 206",
    precio: 50.0,
    categoria: "normal",
    img: "https://m.media-amazon.com/images/I/91dPz7Zyq9L._AC_SL1500_.jpg"
  }
];

let carrito = new Map();

const contenedor = document.getElementById("productos");
const listaCarrito = document.getElementById("lista-carrito");
const totalEl = document.getElementById("total");
const cantidadEl = document.getElementById("cantidad-carrito");

function mostrarProductos(lista) {
  contenedor.innerHTML = "";
  lista.forEach(p => {
    const div = document.createElement("div");
    div.classList.add("producto");
    div.innerHTML = `
      <img src="${p.img}" alt="${p.nombre}">
      <h3>${p.nombre}</h3>
      <p>$${p.precio.toFixed(2)}</p>
      <button onclick="agregarAlCarrito(${p.id})">Agregar</button>
    `;
    contenedor.appendChild(div);
  });
}

function filtrarPorCategoria() {
  const cat = document.getElementById("categoria").value;
  if (cat === "todos") {
    mostrarProductos(productos);
  } else {
    const filtrados = productos.filter(p => p.categoria === cat);
    mostrarProductos(filtrados);
  }
}

function agregarAlCarrito(id) {
  const producto = productos.find(p => p.id === id);
  if (carrito.has(id)) {
    carrito.get(id).cantidad++;
  } else {
    carrito.set(id, { ...producto, cantidad: 1 });
  }
  actualizarCarrito();
  guardarCarrito();
}

function actualizarCarrito() {
  listaCarrito.innerHTML = "";
  let total = 0;
  let cantidad = 0;
  carrito.forEach(item => {
    total += item.precio * item.cantidad;
    cantidad += item.cantidad;
    const li = document.createElement("li");
    li.innerHTML = `${item.nombre} x ${item.cantidad} - $${(item.precio * item.cantidad).toFixed(2)}
      <button onclick="eliminarDelCarrito(${item.id})">❌</button>`;
    listaCarrito.appendChild(li);
  });
  totalEl.textContent = total.toFixed(2);
  cantidadEl.textContent = cantidad;
}

function eliminarDelCarrito(id) {
  const item = carrito.get(id);
  if (item.cantidad > 1) {
    item.cantidad--;
  } else {
    carrito.delete(id);
  }
  actualizarCarrito();
  guardarCarrito();
}

function vaciarCarrito() {
  carrito.clear();
  actualizarCarrito();
  guardarCarrito();
}

// PayPal
paypal.Buttons({
  createOrder: function (data, actions) {
    const total = Array.from(carrito.values()).reduce((sum, item) => sum + item.precio * item.cantidad, 0);
    return actions.order.create({
      purchase_units: [{
        amount: {
          value: total.toFixed(2)
        }
      }]
    });
  },
  onApprove: function (data, actions) {
    return actions.order.capture().then(function (details) {
      alert(`Gracias ${details.payer.name.given_name}, tu compra fue exitosa!`);
      vaciarCarrito();
    });
  }
}).render('#paypal-button-container');

// Guardar/cargar carrito
function guardarCarrito() {
  localStorage.setItem("carritoNicolas", JSON.stringify(Array.from(carrito.entries())));
}

function cargarCarrito() {
  const data = localStorage.getItem("carritoNicolas");
  if (data) {
    carrito = new Map(JSON.parse(data));
    actualizarCarrito();
  }
}

// Inicialización
mostrarProductos(productos);
cargarCarrito();
